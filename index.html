<!-- ... (mesmo CSS anterior) ... -->
<body class="bg-gray-100 pb-24">
    <!-- ... (header anterior) ... -->

    <main class="p-4 max-w-md mx-auto space-y-6">
        <div class="bg-white p-4 rounded-2xl shadow-sm">
            <h2 class="font-bold mb-3 flex items-center gap-2">üìç Entrega</h2>
            
            <!-- Bot√£o de GPS -->
            <button onclick="getGPSLocation()" class="w-full bg-green-100 text-green-700 border border-green-200 py-3 rounded-xl text-sm font-bold flex items-center justify-center gap-2 mb-3">
                üì° Usar minha localiza√ß√£o atual (GPS)
            </button>
            
            <div class="relative flex items-center mb-2">
                <div class="flex-grow border-t border-gray-200"></div>
                <span class="flex-shrink mx-4 text-gray-400 text-xs italic">ou digite</span>
                <div class="flex-grow border-t border-gray-200"></div>
            </div>

            <input type="text" id="address" placeholder="Rua, N√∫mero, Bairro, Cidade" class="w-full border p-3 rounded-xl text-sm mb-2">
            <button onclick="calcDistanciaManual()" class="w-full bg-blue-600 text-white py-2 rounded-xl text-sm font-bold">Calcular Frete</button>
            
            <div id="taxa-info" class="mt-2 text-sm text-gray-600 hidden bg-blue-50 p-2 rounded-lg text-center"></div>
        </div>

        <!-- ... (resto do card√°pio igual) ... -->
    </main>

    <script>
        // Armazena as coordenadas para mandar ao motoboy
        let clientCoords = { lat: null, lon: null };

        async function getGPSLocation() {
            if (!navigator.geolocation) return alert("GPS n√£o suportado pelo seu navegador.");

            const btn = event.target;
            btn.innerText = "üìç Localizando...";

            navigator.geolocation.getCurrentPosition(async (pos) => {
                clientCoords.lat = pos.coords.latitude;
                clientCoords.lon = pos.coords.longitude;

                // Converter coordenadas em nome de rua (Reverse Geocoding)
                try {
                    const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${clientCoords.lat}&lon=${clientCoords.lon}`);
                    const data = await res.json();
                    document.getElementById('address').value = data.display_name;
                    processarDistancia(clientCoords.lat, clientCoords.lon, data.display_name);
                } catch (e) {
                    processarDistancia(clientCoords.lat, clientCoords.lon, "Localiza√ß√£o via GPS");
                }
                btn.innerText = "‚úÖ Localiza√ß√£o Fixada";
            }, (err) => {
                alert("Erro ao obter localiza√ß√£o. Verifique as permiss√µes do GPS.");
                btn.innerText = "üì° Usar minha localiza√ß√£o atual (GPS)";
            });
        }

        async function calcDistanciaManual() {
            const addr = document.getElementById('address').value;
            if(!addr) return alert("Digite o endere√ßo!");
            
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(addr)}`);
            const data = await res.json();
            if(!data[0]) return alert("Endere√ßo n√£o localizado!");

            clientCoords.lat = data[0].lat;
            clientCoords.lon = data[0].lon;
            processarDistancia(data[0].lat, data[0].lon, addr);
        }

        function processarDistancia(lat, lon, addr) {
            let settings = JSON.parse(localStorage.getItem('acai_settings')) || { taxaKm: 2.0, storeCoords: {lat: -23.55, lon: -46.63} };
            
            // C√°lculo de dist√¢ncia
            const dist = Math.sqrt(Math.pow(lat - settings.storeCoords.lat, 2) + Math.pow(lon - settings.storeCoords.lon, 2)) * 111;
            
            deliveryData.km = dist.toFixed(1);
            deliveryData.taxa = dist * settings.taxaKm;
            deliveryData.addr = addr;

            const info = document.getElementById('taxa-info');
            info.innerHTML = `üõµ Dist√¢ncia: ${deliveryData.km}km<br>Taxa: <b>R$ ${deliveryData.taxa.toFixed(2)}</b>`;
            info.classList.remove('hidden');
            updateTotal();
        }

        function finalizarPedido() {
            if(!deliveryData.addr) return alert("Calcule o frete primeiro!");
            
            const pedido = {
                id: Math.floor(Math.random() * 9999),
                cliente: deliveryData.addr,
                item: currentSelection.name,
                total: (parseFloat(currentSelection.price) + deliveryData.taxa).toFixed(2),
                taxa: deliveryData.taxa.toFixed(2),
                coords: clientCoords, // MANDA AS COORDENADAS PARA O MOTOBOY
                status: 'Pendente'
            };

            let pedidos = JSON.parse(localStorage.getItem('pedidos_fila')) || [];
            pedidos.push(pedido);
            localStorage.setItem('pedidos_fila', JSON.stringify(pedidos));

            // Link do Maps para o WhatsApp do dono
            const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${clientCoords.lat},${clientCoords.lon}`;
            const msg = `*NOVO PEDIDO*%0A*Item:* ${pedido.item}%0A*Endere√ßo:* ${pedido.cliente}%0A*Localiza√ß√£o exata:* ${mapsUrl}%0A*Total:* R$ ${pedido.total}`;
            
            window.open(`https://wa.me/${settings.phone}?text=${msg}`);
            alert("Pedido enviado!");
        }
        // ... (resto das fun√ß√µes de renderiza√ß√£o do menu) ...
    </script>
</body>
