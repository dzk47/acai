<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A√ßa√≠ Supreme - Pedir</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f8f9fa; font-family: sans-serif; }
        .acai-gradient { background: linear-gradient(135deg, #4b0082 0%, #310055 100%); }
        .active-card { border: 3px solid #4b0082 !important; transform: scale(1.02); }
    </style>
</head>
<body class="pb-32">

    <div class="acai-gradient text-white p-8 rounded-b-[40px] shadow-xl">
        <h1 class="text-2xl font-black italic">A√áA√ç SUPREME</h1>
        <div class="bg-white rounded-2xl p-2 mt-4 flex items-center gap-2">
            <button onclick="window.getGPS()" class="p-2 bg-purple-100 rounded-xl">üìç</button>
            <input type="text" id="address" placeholder="Seu endere√ßo aqui..." class="w-full outline-none text-sm text-gray-800 px-2">
        </div>
        <p id="taxa-info" class="text-[10px] mt-2 text-purple-200"></p>
    </div>

    <main class="p-4 grid grid-cols-2 gap-4 mt-4" id="menu-container">
        <!-- Itens Fixos para Teste -->
        <div class="bg-white rounded-[30px] p-3 shadow-md border border-gray-100" id="item-1" onclick="window.selectItem(1, 'Copo Supreme 500ml', 25.90)">
            <img src="https://images.unsplash.com/photo-1590301157890-4810ed352733?w=200" class="w-full h-24 object-cover rounded-[20px] mb-2">
            <h3 class="font-bold text-xs">Copo Supreme 500ml</h3>
            <p class="font-bold text-purple-600">R$ 25,90</p>
        </div>
        <div class="bg-white rounded-[30px] p-3 shadow-md border border-gray-100" id="item-2" onclick="window.selectItem(2, 'Barca Especial G', 49.90)">
            <img src="https://images.unsplash.com/photo-1553177595-4de2bb0842b9?w=200" class="w-full h-24 object-cover rounded-[20px] mb-2">
            <h3 class="font-bold text-xs">Barca Especial G</h3>
            <p class="font-bold text-purple-600 text-sm">R$ 49.90</p>
        </div>
    </main>

    <div id="cart-float" class="fixed bottom-6 left-4 right-4 bg-purple-900 text-white p-4 rounded-3xl flex justify-between items-center shadow-2xl hidden">
        <div>
            <p class="text-xs opacity-70" id="cart-item-name">Selecionado</p>
            <p class="font-bold" id="cart-total-display">R$ 0,00</p>
        </div>
        <button onclick="window.enviarPedido()" class="bg-white text-purple-900 px-6 py-2 rounded-xl font-bold">Pedir</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB1DaTOer5_cZ-JT15FlZGapNV1nUDrhmE",
            authDomain: "acai-delibery.firebaseapp.com",
            databaseURL: "https://acai-delibery-default-rtdb.firebaseio.com",
            projectId: "acai-delibery",
            storageBucket: "acai-delibery.firebasestorage.app",
            messagingSenderId: "476733774850",
            appId: "1:476733774850:web:0549e47df6ee8dc2e79b1b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Vari√°veis globais de controle
        window.selectedProduct = null;
        window.clientCoords = { lat: 0, lon: 0 };
        window.taxaEntrega = 5.00; // Valor fixo para teste

        // 1. Fun√ß√£o de Selecionar Produto
        window.selectItem = (id, nome, preco) => {
            window.selectedProduct = { nome, preco };
            document.querySelectorAll('#menu-container > div').forEach(el => el.classList.remove('active-card'));
            document.getElementById(`item-${id}`).classList.add('active-card');
            
            document.getElementById('cart-float').classList.remove('hidden');
            document.getElementById('cart-item-name').innerText = nome;
            const total = preco + window.taxaEntrega;
            document.getElementById('cart-total-display').innerText = `R$ ${total.toFixed(2)} (+taxa)`;
        };

        // 2. Fun√ß√£o de GPS
        window.getGPS = () => {
            if (!navigator.geolocation) return alert("Sem GPS dispon√≠vel");
            navigator.geolocation.getCurrentPosition((pos) => {
                window.clientCoords = { lat: pos.coords.latitude, lon: pos.coords.longitude };
                document.getElementById('address').value = "Localiza√ß√£o via GPS ativa ‚úì";
                document.getElementById('taxa-info').innerText = "Dist√¢ncia calculada! Taxa: R$ 5,00";
            });
        };

        // 3. ENVIAR PARA O FIREBASE (A√ß√£o Real)
        window.enviarPedido = async () => {
            const addr = document.getElementById('address').value;
            if (!addr || !window.selectedProduct) return alert("Preencha o endere√ßo e escolha o a√ßa√≠!");

            const pedido = {
                id: Date.now(),
                cliente: addr,
                item: window.selectedProduct.nome,
                total: (window.selectedProduct.preco + window.taxaEntrega).toFixed(2),
                coords: window.clientCoords,
                status: "pendente",
                hora: new Date().toLocaleTimeString()
            };

            try {
                const pedidosRef = ref(db, 'pedidos');
                await push(pedidosRef, pedido);
                alert("‚úì Pedido Enviado! O motoboy j√° foi avisado.");
                location.reload(); // Reseta o app
            } catch (e) {
                console.error(e);
                alert("Erro ao enviar. Verifique sua internet.");
            }
        };
    </script>
</body>
</html>
